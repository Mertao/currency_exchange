# Проект "Обмен валют"
REST API для описания валют и обменных курсов. Позволяет просматривать и редактировать списки валют и обменных курсов, и совершать расчет конвертации произвольных сумм из одной валюты в другую. 
Веб-интерфейс для проекта не подразумевается

# Установка
Проект подразумевает использование в IDE. Настройки для подключения к БД находятся в `application.yml`.
Также нужно создать файл `application-local.yml` в котором необходимо указать пользователя и пароль в следующем формате:
```yml
spring:
   datasource:
      username: username
      password: 'password'
```
Таблицы БД создадутся автоматически при запуске проекта, если добавить в `application.yml` следующую настройку (в данный момент уже добавлена):
```yml
spring:
   jpa:
      hibernate:
         ddl-auto: update
```

# Мотивация проекта
- Знакомство со Spring Boot
- REST API - правильное именование ресурсов, использование HTTP кодов ответа
- SQL - базовый синтаксис, создание таблиц

# План работы над приложением
- [x] Создать заготовку Java приложения с Spring Boot
- [x] Создать таблицы в базе данных и заполнить их начальными данными
- [x] Реализовать методы REST API для работы с валютами и обменными курсами
- [x] Реализовать метод REST API с подсчетом обмена валюты
- [ ] Деплой на удаленный сервер

## База данных
В качестве базы данных используется PostgreSQL.
### Таблица `currencies`
<table>
    <tr>
        <th>Колонка</th>
        <th>Тип</th>
        <th>Комментарий</th>
    </tr>
    <tr>
      <td>id</td>
      <td>int</td>
      <td>ID валюты, автоинкримент, первичный ключ</td>
    </tr>
    <tr>
        <td>code</td>
        <td>Varchar</td>
        <td>Код валюты</td>
    </tr>
    <tr>
        <td>full_name</td>
        <td>Varchar</td>
        <td>Полное имя валюты</td>
    </tr>
    <tr>
        <td>sign</td>
        <td>Varchar</td>
        <td>Символ валюты</td>
    </tr>
</table>

Пример записи в таблице для австралийского доллара

<table>
  <tr>
    <th>id</th>
    <th>code</th>
    <th>full_name</th>
    <th>sign</th>
  </tr>
  <tr>
    <td>1</td>
    <td>AUD</td>
    <td>Australian dollar</td>
    <td>A$</td>
  </tr>
</table>

Индексы:
- Первичный ключ по полю id
- Unique индекс по полю Code для гарантий уникальности валюты в таблице, и для ускорения поиска валюты по ее аббревиатуре

### Таблица `exchange_rates`
<table>
    <tr>
        <th>Колонка</th>
        <th>Тип</th>
        <th>Комментарий</th>
    </tr>
    <tr>
      <td>id</td>
      <td>int</td>
      <td>ID курса обмена, автоинкримент, первичный ключ</td>
    </tr>
    <tr>
        <td>base_currency_id</td>
        <td>int</td>
        <td>ID базовой валюты, внешний ключ на currencies.id</td>
    </tr>
    <tr>
        <td>target_currency_id</td>
        <td>int</td>
        <td>ID базовой валюты, внешний ключ на currencies.id</td>
    </tr>
    <tr>
        <td>rate</td>
        <td>numeric(2)</td>
        <td>Курс обмена единицы базовой валюты к единице целевой валюты</td>
    </tr>
</table>

Индексы:
- Первичный ключ по полю id
- Unique индекс по паре полей base_currency_id и target_currency_id для гарантий уникальности валютной пары, и для ускорения поиска курса по паре валют.

## REST API
Методы REST API реализуют CRUD интерфейс над базой данных, но в целях упрощения удаление опущено.

## Валюты
### GET `/currency`
Получение списка валют. Пример ответа:
```json
[
    {
        "id": 0,
        "name": "United States dollar",
        "code": "USD",
        "sign": "$"
    },   
    {
        "id": 0,
        "name": "Euro",
        "code": "EUR",
        "sign": "€"
    }
]
```
HTTP коды ответов:
- Успех - 200
- Ошибка (например, база данных недоступна) - 500

### GET `/currency/EUR`
Получение конкретной валюты. Пример ответа:
```json
{
    "id": 0,
    "name": "Euro",
    "code": "EUR",
    "sign": "€"
}
```
HTTP коды ответов:
- Успех - 200
- Код валюты отсутствует в адресе - 400
- Валюта не найдена - 404
- Ошибка (например, база данных недоступна) - 500

### POST `/currency`
Добавление новой валюты в базу. Данные передаются в теле запроса в виде полей формы (`x-www-form-urlencoded`). 
Пример полей формы: 
- `name` - Euro
- `code` - EUR
- `sign` - €

Пример ответа - JSON представление вставленной в базу записи, включая ее ID.
```json
{
    "id": 0,
    "name": "Euro",
    "code": "EUR",
    "sign": "€"
}
```
HTTP коды ответов:
- Успех - 201
- Отсутствует нужное поле формы - 400
- Валюта с таким кодом уже существует - 409
- Ошибка (например, база данных недоступна) - 500

## Обменные курсы
### GET `/exchangeRate`
Получение списка всех обменных курсов. Пример ответа:
```json
[
    {
        "id": 0,
        "baseCurrency": {
            "id": 0,
            "name": "United States dollar",
            "code": "USD",
            "sign": "$"
        },
        "targetCurrency": {
            "id": 1,
            "name": "Euro",
            "code": "EUR",
            "sign": "€"
        },
        "rate": 0.99
    }
]
```
HTTP коды ответов:
- Успех - 200
- Ошибка (например, база данных недоступна) - 500

### GET `/exchangeRate/USDRUB`
Получение конкретного обменного курса. Валютная пара задается идущими подряд кодами валют в адресе запроса. Пример ответа:
```json
{
    "id": 0,
    "baseCurrency": {
        "id": 0,
        "name": "United States dollar",
        "code": "USD",
        "sign": "$"
    },
    "targetCurrency": {
        "id": 1,
        "name": "Euro",
        "code": "EUR",
        "sign": "€"
    },
    "rate": 0.99
}
```

### POST `/exchangeRate`
Добавление нового обменного курса в базу. Данные передаются в теле запроса в виде полей формы (x-www-form-urlencoded). 
Пример полей формы:
- `baseCurrencyCode` - USD
- `targetCurrencyCode` - EUR
- `rate` - 0.99
Пример ответа - JSON представление вставленной в базу записи, включая ее id:
```json
{
    "id": 0,
    "baseCurrency": {
        "id": 0,
        "name": "United States dollar",
        "code": "USD",
        "sign": "$"
    },
    "targetCurrency": {
        "id": 1,
        "name": "Euro",
        "code": "EUR",
        "sign": "€"
    },
    "rate": 0.99
}
```
HTTP коды ответов:
- Успех - 201
- Отсутствует нужное поле формы - 400
- Валютная пара с таким кодом уже существует - 409
- Одна (или обе) валюта из валютной пары не существует в БД - 404
- Ошибка (например, база данных недоступна) - 500

### PATCH `/exchangeRate/USDRUB`
Обновление существующего в базе обменного курса. Валютная пара задаётся идущими подряд кодами валют в адресе запроса. Данные передаются в теле запроса в виде полей формы (x-www-form-urlencoded). Единственное поле формы - `rate`.
Пример ответа - JSON представление обновлённой записи в базе данных, включая её ID:
```json
{
    "id": 0,
    "baseCurrency": {
        "id": 0,
        "name": "United States dollar",
        "code": "USD",
        "sign": "$"
    },
    "targetCurrency": {
        "id": 1,
        "name": "Euro",
        "code": "EUR",
        "sign": "€"
    },
    "rate": 0.99
}
```
HTTP коды ответов:
- Успех - 200
- Отсутствует нужное поле формы - 400
- Валютная пара отсутствует в базе данных - 404
- Ошибка (например, база данных недоступна) - 500

## Обмен валюты
### `GET /exchange?from=BASE_CURRENCY_CODE&to=TARGET_CURRENCY_CODE&amount=$AMOUNT`
Расчёт перевода определённого количества средств из одной валюты в другую. Пример запроса - `GET /exchange?from=USD&to=AUD&amount=10`.
Пример ответа:
```json
{
    "baseCurrency": {
        "id": 0,
        "name": "United States dollar",
        "code": "USD",
        "sign": "$"
    },
    "targetCurrency": {
        "id": 1,
        "name": "Australian dollar",
        "code": "AUD",
        "sign": "A€"
    },
    "rate": 1.45,
    "amount": 10.00,
    "convertedAmount": 14.50
}
```
Получение курса для обмена может пройти по одному из трёх сценариев. Допустим, совершаем перевод из валюты A в валюту B:
1. В таблице `ExchangeRates` существует валютная пара **AB** - берём её кур
2. В таблице `ExchangeRates` существует валютная пара **BA** - берем её курс, и считаем обратный, чтобы получить AB
3. В таблице `ExchangeRates` существуют валютные пары **USD-A** и **USD-B** - вычисляем из этих курсов курс AB
